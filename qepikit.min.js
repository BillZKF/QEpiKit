var QEpiKit;!function(t){var n=function(){function n(n){this.id=t.Utils.generateUUID(),this.name=n,this.time=0,this.history=[]}return n.prototype.update=function(t,n){},n}();n.SUCCESS=1,n.FAILED=2,n.RUNNING=3,t.QComponent=n}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(n){function e(t,i,r,o,a){void 0===i&&(i=[]),void 0===r&&(r={}),void 0===o&&(o=[]),void 0===a&&(a=e.stochasticSelection);var s=n.call(this,t)||this;return s.goals=i,s.plans=r,s.data=o,s.policySelector=a,s.beliefHistory=[],s.planHistory=[],s}return __extends(e,n),e.prototype.update=function(t,n){var e,i,r;e=this.policySelector(this.plans,this.planHistory,t),i=this.plans[e],i(t,n),r=this.evaluateGoals(t),this.planHistory.push({time:this.time,id:t.id,intention:e,goals:r.achievements,barriers:r.barriers,r:r.successes/this.goals.length})},e.prototype.evaluateGoals=function(n){for(var i,r,o=[],a=[],s=0,h=0;h<this.goals.length;h++)i=this.goals[h].condition,"undefined"!=typeof i.data&&"agent"!==i.data||(i.data=n),o[h]=this.goals[h].temporal(i.check(i.data[i.key],i.value)),o[h]===e.SUCCESS?s+=1:(r=t.Utils.getMatcherString(i.check),a.push({label:i.label,key:i.key,check:r,actual:i.data[i.key],expected:i.value}));return{successes:s,barriers:a,achievements:o}},e.stochasticSelection=function(t,n,e){var i,r,o=0;for(var a in t)r=Math.random(),r>=o&&(o=r,i=a);return i},e}(t.QComponent);n.lazyPolicySelection=function(t,n,e){var i,r;return this.time>0?(i=Object.keys(t),i=i.slice(1,i.length),r=Math.floor(Math.random()*i.length)):(i=Object.keys(t),r=0),i[r]},t.BDIAgent=n}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(t){function n(n,e,i){var r=t.call(this,n)||this;return r.root=e,r.data=i,r.results=[],r}return __extends(n,t),n.tick=function(t,n){var e=t.operate(n);return e},n.prototype.update=function(t,e){var i;for(t.active=!0;t.active===!0;)i=n.tick(this.root,t),t.time=this.time,t.active=!1;return i},n}(t.QComponent);t.BehaviorTree=n;var e=function(){function n(n){this.id=t.Utils.generateUUID(),this.name=n}return n}();t.BTNode=e;var i=function(t){function n(n,e){var i=t.call(this,n)||this;return i.children=e,i}return __extends(n,t),n}(e);t.BTControlNode=i;var r=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="root",r.operate=function(t){var e=n.tick(this.children[0],t);return e},r}return __extends(e,t),e}(i);t.BTRoot=r;var o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="selector",r.operate=function(t){var e;for(var i in this.children){if(e=n.tick(this.children[i],t),e===n.RUNNING)return n.RUNNING;if(e===n.SUCCESS)return n.SUCCESS}return n.FAILED},r}return __extends(e,t),e}(i);t.BTSelector=o;var a=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="sequence",r.operate=function(t){var e;for(var i in this.children){if(e=n.tick(this.children[i],t),e===n.RUNNING)return n.RUNNING;if(e===n.FAILED)return n.FAILED}return n.SUCCESS},r}return __extends(e,t),e}(i);t.BTSequence=a;var s=function(t){function e(e,i,r){var o=t.call(this,e,i)||this;return o.type="parallel",o.successes=r,o.operate=function(t){var e,i=[],r=[];for(var o in this.children)if(e=n.tick(this.children[o],t),e===n.SUCCESS)i.push(e);else if(e===n.FAILED)r.push(e);else if(e===n.RUNNING)return n.RUNNING;return i.length>=this.successes?n.SUCCESS:n.FAILED},o}return __extends(e,t),e}(i);t.BTParallel=s;var h=function(t){function n(n,e){var i=t.call(this,n)||this;return i.type="condition",i.condition=e,i.operate=function(t){var n;return n=e.check(t[e.key],e.value)},i}return __extends(n,t),n}(e);t.BTCondition=h;var u=function(t){function e(e,i,r){var o=t.call(this,e)||this;return o.type="action",o.condition=i,o.action=r,o.operate=function(t){var e;return e=i.check(t[i.key],i.value),e===n.SUCCESS&&this.action(t),e},o}return __extends(e,t),e}(e);t.BTAction=u}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(t){function n(n,e){var i=t.call(this,n)||this;i.data=e,i.totalPop=0,i.history=[];for(var r=0;r<i.data.length;r++)i.totalPop+=i.data[r].totalPop;return i._tolerance=1e-9,i}return __extends(n,t),n.prototype.update=function(t,n){for(var e=[],i=[],r=[],o=t.compartments,a=0;a<o.length;a++)o[a].dpop=o[a].operation(n);for(var a=0;a<o.length;a++)e[a]=o[a].pop,i[a]=o[a].dpop,o[a].pop=e[a]+i[a];t.totalPop=0;for(var a=0;a<o.length;a++)r[a]=o[a].operation(n),o[a].pop=e[a]+.5*(i[a]+r[a]),t.totalPop+=o[a].pop},n}(t.QComponent);t.CompartmentModel=n;var e=function(){function t(t,n,e){this.name=t,this.pop=n,this.operation=e||null,this.dpop=0}return t}();t.Compartment=e;var i=function(){function t(n,e){this.id=t.newId(),this.name=n,this.compartments=e,this.totalPop=0;for(var i=0;i<this.compartments.length;i++)this.totalPop+=this.compartments[i].pop,this.compartments[i].initialPop=this.compartments[i].pop}return t.newId=function(){return t.cId++,t.cId},t}();i.cId=0,t.Patch=i}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function n(n,e){this.id=t.Utils.generateUUID(),this.name=n,this.capacity=e,this.pop=0,this.members={}}return n.defaultFreqF=function(t,n){var e=(50-Math.abs(t.age-n.age))/100;return e},n.defaultContactF=function(t,n){var e=2*Math.sin(n)+t;return e>=1},n.prototype.assign=function(t,e){var i;if(e=e||n.defaultFreqF,this.pop<this.capacity){this.members[t.id]={properties:t};for(var r in this.members)r=Number(r),r===t.id||isNaN(r)||(i=e(this.members[r].properties,t),this.members[t.id][r]=i,this.members[r][t.id]=i);return this.pop++,this.id}return null},n.prototype.encounters=function(t,e,i,r,o){void 0===o&&(o=!1),i=i||n.defaultContactF;var a;for(var s in this.members)if(a="states"===e.key?JSON.stringify(this.members[s].properties[e.key]):this.members[s].properties[e.key],e.check(this.members[s].properties[e.key],e.value)&&Number(s)!==t.id){var h=this.members[s].properties[r],u=i(this.members[s],t);h!==u&&o===!0&&(this.members[s].properties[r]=u,n.WIWArray.push({patchID:this.id,name:this.name,infected:s,infectedAge:this.members[s].properties.age,result:this.members[s].properties[r],resultKey:r,by:t.id,byAge:t.age,time:t.time}))}},n}();n.WIWArray=[],t.ContactPatch=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function n(t,n,e,i,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===e&&(e=[]),void 0===i&&(i="random"),void 0===r&&(r=Math.random),this.time=0,this.timeOfDay=0,this.models=[],this.history=[],this.agents=[],this.resources=t,this.facilities=n,this.eventsQueue=e,this.activationType=i,this.randF=r,this._agentIndex={}}return n.prototype.add=function(t){this.models.push(t)},n.prototype.remove=function(t){var n,e=this.agents.length;for(this.models.forEach(function(e,i){e.id===t&&(n=i)});e>0&&this.agents.length>=0;)e--,this.agents[e].modelIndex===n&&this.agents.splice(e,1);this.models.splice(n,1)},n.prototype.run=function(t,n,e){for(this.init();this.time<=n;){this.update(t);var i=this.time%e;if(i<t){var r=JSON.parse(JSON.stringify(this.agents));this.history=this.history.concat(r)}this.time+=t,this.formatTime()}},n.prototype.init=function(){this._agentIndex={};for(var t=(function(t){for(var e=[],i=0;i<n.models[t].data.length;i++){var r=n.models[t].data[i].id;r in n._agentIndex?(n.models[t].data[i].models.push(n.models[t].name),n.models[t].data[i].modelIndexes.push(t),e.push(r)):(n._agentIndex[r]=0,n.models[t].data[i].models=[n.models[t].name],n.models[t].data[i].modelIndexes=[t])}n.models[t].data=n.models[t].data.filter(function(t){return e.indexOf(t.id)===-1}),n.agents=n.agents.concat(n.models[t].data)}),n=this,e=0;e<this.models.length;e++)t(e)},n.prototype.update=function(n){for(var e=this,i=0;i<this.eventsQueue.length&&this.eventsQueue[i].at<=this.time;)this.eventsQueue[i].trigger(),this.eventsQueue[i].triggered=!0,this.eventsQueue[i].until<=this.time&&this.eventsQueue.splice(i,1),i++;if("random"===this.activationType&&(t.Utils.shuffle(this.agents,this.randF),this.agents.forEach(function(t,n){e._agentIndex[t.id]=n}),this.agents.forEach(function(t,i){t.modelIndexes.forEach(function(i){e.models[i].update(t,n)}),t.time=t.time+n||0})),"parallel"===this.activationType){var r=JSON.parse(JSON.stringify(this.agents));r.forEach(function(t){t.modelIndexes.forEach(function(i){e.models[i].update(t,n)})}),this.agents.forEach(function(t,i){t.modelIndexes.forEach(function(o){e.models[o].apply(t,r[i],n)}),t.time=t.time+n||0})}},n.prototype.formatTime=function(){this.timeOfDay=this.time%1},n.prototype.getAgentById=function(t){return this.agents[this._agentIndex[t]]},n}();t.Environment=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function t(){}return t.prevalence=function(t,n){var e=t/n;return e},t.riskDifference=function(t){var n=t.a/(t.a+t.b)-t.c/(t.c+t.d);return n},t.riskRatio=function(t){var n=t.a/(t.a+t.b)/(t.c/(t.c+t.d));return n},t.oddsRatio=function(t){var n=t.a*t.d/(t.b*t.c);return n},t.IPF2D=function(t,n,e,i){var r=0,o=0,a=i;if(t.forEach(function(t,n){r+=t,a[n]=a[n]||[]}),n.forEach(function(e,i){o+=e,a.forEach(function(e,r){a[r][i]=a[r][i]||Math.round(t[r]/t.length+n[i]/n.length/2*Math.random())})}),r===o){for(var s=0;s<e;s++){a.forEach(function(n,e){var i=0;n.forEach(function(t,n){i+=t}),n.forEach(function(n,r){a[e][r]=n/i,a[e][r]*=t[e]})});for(var h=0;h<n.length;h++){var u=0;a.forEach(function(t,n){u+=t[h]}),a.forEach(function(t,e){a[e][h]=t[h]/u,a[e][h]*=n[h]})}}return a}},t}();t.Epi=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function t(t){void 0===t&&(t=[]),this.queue=[],this.schedule(t)}return t.prototype.scheduleRecurring=function(t,n,e){var i=[],r=e-t.at,o=Math.floor(r/n);t.until||(t.until=t.at);for(var a=0;a<=o;a++)i.push({name:t.name+a,at:t.at+a*n,until:t.until+a*n,trigger:t.trigger,triggered:!1});this.schedule(i)},t.prototype.schedule=function(t){t.forEach(function(t){t.until=t.until||t.at}),this.queue=this.queue.concat(t),this.queue=this.organize(this.queue,0,this.queue.length)},t.prototype.partition=function(t,n,e){var i,r=t[e-1].at,o=n;for(i=n;i<e-1;i+=1)t[i].at<=r&&(this.swap(t,i,o),o+=1);return this.swap(t,o,e-1),o},t.prototype.swap=function(t,n,e){var i=t[n];return t[n]=t[e],t[e]=i,t},t.prototype.organize=function(t,n,e){if(n<e){var i=this.partition(t,n,e);this.organize(t,n,i),this.organize(t,i+1,e)}return t},t}();t.Events=n}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(n){function e(e,i,r,o){void 0===r&&(r=!1),void 0===o&&(o=!0);var a=n.call(this,e,i)||this;a.ranges=i.evolution.params,a.size=i.experiment.size,a.discrete=r,a.gradient=o,a.population=[];for(var s=0;s<a.size;s++){for(var h=new t.Chromasome,u=0;u<a.ranges.length;u++)h.genes.push(new t.Gene(a.ranges[u].ranges,a.discrete));a.population.push(h)}return a}return __extends(e,n),e.prototype.dscSort=function(t,n){return t.score>n.score?-1:t.score<n.score?1:0},e.prototype.ascSort=function(t,n){return t.score>n.score?1:t.score<n.score?-1:0},e.prototype.prep=function(e,i){if(this.mating){var r=Math.round(.1*this.size)+2,o=this.mate(r);this.population=this.population.concat(o)}for(var a=0;a<this.population.length;a++)this.mutate(this.population[a],1);for(var s=0;s<this.population.length;s++){for(var h=function(n){var e=u.ranges[n],r=i.agents.map(function(t,n){if(e.group==t.name)return n}),o=i.agents[r[0]].map(function(t,n){if(e.name==t.name)return n});i.agents[r[0]].params[o[0]]=t.Utils.invNorm(u.population[s].genes[n].code,e.range[0],e.range[1])},u=this,c=0;c<this.ranges.length;c++)h(c);n.prototype.prep.call(this,e,i);var p=this.report(e,i);this.population[s].score=this.cost(p,this.target)}},e.prototype.cost=function(t,n){var e=0;for(var i in n.mean)e+=Math.pow(n.mean[i]-t.mean[i],2);return e},e.prototype.report=function(t,e){return n.prototype.report.call(this,t,e)},e.prototype.mate=function(n){for(var e=.5*this.ranges.length*this.ranges.length,i=[],r=0;r<e;r++){for(var o=new t.Chromasome,a=0;a<this.ranges.length;a++){var s=new t.Gene([this.ranges[a].range[0],this.ranges[a].range[1]],this.discrete),h=Math.floor(Math.random()*n),u=this.population[h].genes.slice(a,a+1);s.code=u[0].code,o.genes.push(s)}i.push(o)}return i},e.prototype.mutate=function(n,e){if(!(Math.random()>e))for(var i=this.population[0].genes,r=0;r<n.genes.length;r++){var o=n.genes[r],a=void 0;a=this.gradient?i[r].code-o.code:t.Utils.randRange(-1,1);var s=a>0?1:-1;this.discrete?o.code+=s:o.code+=s*this.mutateRate*Math.random(),o.code=Math.min(Math.max(0,o.code),1)}},e}(t.Experiment);t.Evolutionary=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function n(t,n,e){this.environment=t,this.setup=n,this.target=n.target,this.experimentLog=[]}return n.prototype.start=function(t,n,e){for(var i=0;i<t;)this.prep(i,this.setup),this.environment.time=0,this.environment.run(n,e,0),this.experimentLog[i]=this.report(i,this.setup),i++},n.prototype.prep=function(n,e,i,r){var o=this,a={},s=0;switch(this.environment=new t.Environment,e.agents.forEach(function(t){s=a[t.name][a[t.name].length-1].id}),e.components.forEach(function(n){switch(n.type){case"state-machine":var e=new t.StateMachine(n.name,n.states,n.transitions,n.conditions,a[n.agents][0]);o.environment.add(e);break;case"every-step":o.environment.add({id:t.Utils.generateUUID(),name:n.name,update:n.action,data:a[n.agents][0]})}}),e.experiment){default:null==n?r():(i=this.environment.agents,this.environment.run(e.environment.step,e.environment.until,0))}},n.prototype.report=function(t,n){var e=this,i={},r={},o={},a={};return n.report.sum=n.report.sum.concat(n.report.mean),this.environment.agents.forEach(function(t,e){n.report.sum.forEach(function(n){i[n]=void 0==i[n]?t[n]:t[n]+i[n]}),n.report.freq.forEach(function(n){o[n]=o[n]||{},o[n][t[n]]=void 0==o[n][t[n]]?1:o[n][t[n]]+1})}),n.report.mean.forEach(function(t){r[t]=i[t]/e.environment.agents.length}),{count:this.environment.agents.length,sums:i,means:r,freq:o,model:a}},n.prototype.sweep=function(t,n,e){void 0===e&&(e=!0);var i=[];e===!0&&(t.baseline=[!0]);for(var r in t)for(var o=0;o<t[r].length;o++)for(var a=0;a<n;a++)i.push({param:r,value:t[r][o],run:a});this.plans=i},n.prototype.boot=function(t){var n;for(var e in t)if("undefined"==typeof n&&(n=t[e].length),t[e].length!==n)throw"length of parameter arrays did not match";this.plans=t},n}();t.Experiment=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function n(n,e){var i=t.Utils.randRange(n[0],n[1]);e?this.code=Math.floor(i):this.code=t.Utils.normalize(i,n[0],n[1])}return n}();t.Gene=n;var e=function(){function t(){this.genes=[]}return t}();t.Chromasome=e;var i=function(){function i(t,i,r,o,a,s){void 0===a&&(a=!1),void 0===s&&(s=!0),this.ranges=i,this.target=r,this.discrete=a,this.cost=o,this.size=t,this.gradient=s,this.population=[];for(var h=0;h<this.size;h++){for(var u=new e,c=0;c<i.length;c++)u.genes.push(new n(this.ranges[c],this.discrete));this.population.push(u)}}return i.prototype.run=function(t,n){for(void 0===n&&(n=!1),this.mutateRate=.01,this.mating=n;t--;)this.generation(),this.population.sort(this.ascSort);return this.population},i.prototype.dscSort=function(t,n){return t.score>n.score?-1:t.score<n.score?1:0},i.prototype.ascSort=function(t,n){return t.score>n.score?1:t.score<n.score?-1:0},i.prototype.generation=function(){if(this.mating){var t=Math.round(.01*this.size)+2,n=this.mate(t);this.population=this.population.concat(n)}for(var e=0;e<this.population.length;e++)this.mutate(this.population[e],1);for(var i=0;i<this.population.length;i++)this.population[i].score=this.cost(this.population[i],this.target)},i.prototype.mate=function(t){for(var i=.5*this.ranges.length*this.ranges.length,r=[],o=0;o<i;o++){for(var a=new e,s=0;s<this.ranges.length;s++){var h=new n([this.ranges[s][0],this.ranges[s][1]],this.discrete),u=Math.floor(Math.random()*t),c=this.population[u].genes.slice(s,s+1);h.code=c[0].code,a.genes.push(h)}r.push(a)}return r},i.prototype.mutate=function(n,e){if(!(Math.random()>e))for(var i=this.population[0].genes,r=0;r<n.genes.length;r++){var o=n.genes[r],a=void 0;a=this.gradient?i[r].code-o.code:t.Utils.randRange(-1,1);var s=a>0?1:-1;this.discrete?o.code+=s:o.code+=s*this.mutateRate*Math.random(),o.code=Math.min(Math.max(0,o.code),1)}},i}();t.Genetic=i}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function n(n,e){this.id=t.Utils.generateUUID(),this.name=n,this.geoJSON=JSON}return n}();t.GeoPatch=n}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(n){function e(t,e,i,r,o,a){var s=n.call(this,t)||this;return s.data=e,s.flowSet=i,s.flowMap=r,s.jumpSet=o,s.jumpMap=a,s}return __extends(e,n),e.prototype.update=function(n,e){var i=JSON.parse(JSON.stringify(n));for(var r in this.jumpSet){var o=this.jumpSet[r],a=o.check(n[o.key],o.value);if(a===t.Utils.SUCCESS&&r!=n.currentMode)try{n[o.key]=this.jumpMap[o.key][n.currentMode][r](n[o.key]),n.currentMode=r}catch(t){}for(var s in this.flowMap){var h=this.flowMap[s][n.currentMode](n[s]);i[s]=n[s]+h,n[s]+=.5*(h+this.flowMap[s][n.currentMode](i[s]))}}},e}(t.QComponent);t.HybridAutomata=n}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(t){function n(n,e,i,r){var o=t.call(this,n)||this;return o.root=e,o.data=r,o.summary=[],o.results=[],o.task=i,o}return __extends(n,t),n.tick=function(t,n,e){e.runningList?e.runningList.push(t.name):(e.runningList=[t.name],e.successList=[],e.barrierList=[],e.blackboard=[]);var i=t.visit(e,n);return i},n.prototype.update=function(t,e){t.active=!0,n.tick(this.root,this.task,t),t.successList.length>0?t.succeed=!0:t.succeed=!1,t.active=!1},n}(t.QComponent);t.HTNPlanner=n;var e=function(){function t(t,n){this.name=t,this.goals=n}return t.prototype.evaluateGoal=function(t){for(var n,e,i=0;i<this.goals.length;i++)return e=this.goals[i],n=e.data?e.check(e.data[e.key],e.value):e.check(t[e.key],e.value)},t}();t.HTNRootTask=e;var i=function(){function e(n,e){this.id=t.Utils.generateUUID(),this.name=n,this.preconditions=e}return e.prototype.evaluatePreConds=function(t){var e;if(this.preconditions instanceof Array)for(var i=0;i<this.preconditions.length;i++)if(e=this.preconditions[i].check(t[this.preconditions[i].key],this.preconditions[i].value),e===n.FAILED)return n.FAILED;return n.SUCCESS},e}();t.HTNNode=i;var r=function(t){function e(e,i,r){var o=t.call(this,e,i)||this;return o.type="operator",o.effects=r,o.visit=function(t,e){if(this.evaluatePreConds(t)===n.SUCCESS){for(var i=0;i<this.effects.length;i++)this.effects[i](t.blackboard[0]);return e.evaluateGoal(t.blackboard[0])===n.SUCCESS?(t.successList.unshift(this.name),n.SUCCESS):n.RUNNING}return t.barrierList.unshift({name:this.name,conditions:this.preconditions}),n.FAILED},o}return __extends(e,t),e}(i);t.HTNOperator=r;var o=function(t){function e(e,i,r){var o=t.call(this,e,i)||this;return o.type="method",o.children=r,o.visit=function(t,e){var i=JSON.parse(JSON.stringify(t));if(delete i.blackboard,t.blackboard.unshift(i),this.evaluatePreConds(t)===n.SUCCESS)for(var r=0;r<this.children.length;r++){var o=n.tick(this.children[r],e,t);if(o===n.SUCCESS)return t.successList.unshift(this.name),n.SUCCESS}else t.barrierList.unshift({name:this.name,conditions:this.preconditions});return n.FAILED},o}return __extends(e,t),e}(i);t.HTNMethod=o}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function t(t,n,e){var i=this;this.centroids=[],this.limits={},this.iterations=0,n.forEach(function(t){i.limits[t]={min:1e15,max:-1e15}}),t.forEach(function(t){n.forEach(function(n){t[n]>i.limits[n].max&&(i.limits[n].max=t[n]),t[n]<i.limits[n].min&&(i.limits[n].min=t[n])})});for(var r=function(t){o.centroids[t]={count:0},n.forEach(function(n){var e=Math.random()*i.limits[n].max+i.limits[n].min;i.centroids[t][n]=e})},o=this,a=0;a<e;a++)r(a);this.data=t,this.props=n}return t.prototype.update=function(){this._assignCentroid(),this._moveCentroid()},t.prototype.run=function(){for(var t=!1;!t;)this.update(),this.centroids.forEach(function(n){t=n.finished}),this.iterations++;return[this.centroids,this.data]},t.prototype._assignCentroid=function(){var t=this;this.data.forEach(function(n,e){var i,r,o=[],a=[];t.centroids.forEach(function(e,i){o[i]={},a[i]=0,t.props.forEach(function(t){o[i][t]=Math.sqrt((n[t]-e[t])*(n[t]-e[t])),a[i]+=o[i][t]}),a[i]=Math.sqrt(a[i])}),i=Math.min.apply(null,a),r=a.indexOf(i),n.centroid=r,n.distances=o,t.centroids[r].count+=1})},t.prototype._moveCentroid=function(){var t=this;this.centroids.forEach(function(n,e){var i={};t.props.forEach(function(t){return i[t]=[]}),t.data.forEach(function(n){n.centroid===e&&t.props.forEach(function(t){i[t].push(n[t])})}),0===n.count&&t.props.forEach(function(n){i[n]=[Math.random()*t.limits[n].max+t.limits[n].min]}),t.props.forEach(function(t){var e=i[t].reduce(function(t,n){return t+n},0),r=e/i[t].length;n[t]!==r?(n[t]=r,n.finished=!1,n.count=0):n.finished=!0})})},t}();t.kMean=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function t(){}return t.prototype.setNeighbors=function(t,n,e,i){n.forEach(function(n){n.id!==t.id&&(t.neighbors[n.id]=t.neighbors[n.id]||{},t.neighbors[n.id][i]=n[i],t.neighbors[n.id][e.param]=Math.abs(t[e.param]-n[e.param])/e.range)})},t.prototype.sort=function(t,n){var e=[];for(var i in t)e.push(t[i]);return e.sort(function(t,e){return t[n]>=e[n]?1:e[n]>=t[n]?-1:0}),e},t.prototype.setDistances=function(t,n,e,i){for(var r=0;r<t.length;r++){t[r].neighbors={};for(var o=0;o<e.length;o++)"number"==typeof t[r][e[o].param]&&this.setNeighbors(t[r],n,e[o],i);for(var a in t[r].neighbors){for(var s=t[r].neighbors[a],h=0,u=0;u<e.length;u++)h+=s[e[u].param]*s[e[u].param];s.distance=Math.sqrt(h)}}return t},t.prototype.getRange=function(t,n){for(var e=[],i=1e20,r=0,o=0;o<n.length;o++){for(var a=0;a<t.length;a++)t[a][n[o]]<i&&(i=t[a][n[o]]),t[a][n[o]]>r&&(r=t[a][n[o]]);e.push({param:n[o],min:i,max:r,range:r-i})}return e},t.prototype.classify=function(t,n,e,i,r){var o=this.getRange([].concat(t,n),e);t=this.setDistances(t,n,o,i);for(var a=[],s=0;s<t.length;s++){var h={};a=this.sort(t[s].neighbors,"distance");for(var u=0;u<r;){var c=a[u][i];h[c]=h[c]||0,h[c]+=1,u++}var p=0,f="";for(var l in h)h[l]>p&&(p=h[l],f=l);t[s][i]=f}return t},t}();t.KNN=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function t(n,e,i,r,o){void 0===o&&(o="tanh"),this.el=r,this.iter=0,this.correct=0,this.hiddenNum=i,this.learnRate=.01,this.actFn=t.activationMethods[o],this.derFn=t.deriviteMethods[o],this.init(n,e)}return t.prototype.learn=function(t,n,e,i){void 0===i&&(i=100),this.correct=0;for(var r=function(t){var i=Math.floor(Math.random()*n.length);o.iter++,o.forward(n[i]);var r=-1,a=Math.floor(Math.random()*o.values.length);o.values[o.values.length-1].forEach(function(t,n){t>r&&(a=n,r=t)});var s=o.values[o.values.length-1][a]>=.5?1:0;s===e[i][a]&&o.correct++,o.accuracy=o.correct/(t+1),o.backward(e[i]),o.updateWeights(),o.resetTotals()},o=this,a=0;a<t;a++)r(a)},t.prototype.classify=function(t){return this.resetTotals(),this.forward(t),this.values[this.values.length-1]},t.prototype.init=function(t,n){var e=[];this.der=[],this.values=[],this.weights=[],this.weightChanges=[],this.totals=[],this.derTotals=[],this.biases=[];for(var i=0;i<t[0].length;i++)e.push(0);for(var r=0;r<this.hiddenNum.length;r++){this.der[r]=[],this.values[r]=[],this.totals[r]=[],this.derTotals[r]=[];for(var o=0;o<this.hiddenNum[r];o++)this.values[r][o]=0,this.der[r][o]=0,this.totals[r][o]=0,this.derTotals[r][o]=0}this.values.unshift(e),this.totals.unshift(e),this.der.unshift(e),this.derTotals.unshift(e),this.values[this.hiddenNum.length+1]=n[0].map(function(t){return 0}),this.totals[this.hiddenNum.length+1]=n[0].map(function(t){return 0}),this.der[this.hiddenNum.length+1]=n[0].map(function(t){return 0}),this.derTotals[this.hiddenNum.length+1]=n[0].map(function(t){return 0});for(var a=0;a<this.values.length-1;a++){this.weights[a]=[],this.weightChanges[a]=[],this.biases[a]=[];for(var s=0;s<this.values[a].length;s++){this.weights[a][s]=[],this.weightChanges[a][s]=[];for(var h=0;h<this.values[a+1].length;h++)this.biases[a][h]=Math.random()-.5,this.weights[a][s][h]=Math.random()-.5,this.weightChanges[a][s][h]=0}}},t.prototype.resetTotals=function(){for(var t=0;t<this.totals.length;t++)for(var n=0;n<this.totals[t].length;n++)this.totals[t][n]=0,this.derTotals[t][n]=0},t.prototype.forward=function(t){var n=this;this.values[0]=t;for(var e=function(t){for(var e=t,r=t+1,o=0;o<i.weights[t].length;o++)for(var a=0;a<i.weights[t][o].length;a++)i.totals[r][a]+=i.values[e][o]*i.weights[t][o][a];i.values[r]=i.totals[r].map(function(e,i){return n.actFn(e+n.biases[t][i])})},i=this,r=0;r<this.weights.length;r++)e(r)},t.prototype.backward=function(t){for(var n=this.weights.length-1;n>=0;n--)for(var e=n,i=n+1,r=0;r<this.weights[n].length;r++){for(var o=0,a=0;a<this.weights[n][r].length;a++)n===this.weights.length-1?(o+=t[a]-this.values[i][a],this.der[i][a]=o):o+=this.der[i][a]*this.weights[n][r][a];this.derTotals[e][r]=o,this.der[e][r]=o*this.derFn(this.values[e][r])}},t.prototype.updateWeights=function(){for(var t=this,n=function(n){for(var i=n,r=n+1,o=0;o<e.weights[n].length;o++)for(var a=0;a<e.weights[n][o].length;a++){var s=.1*e.weightChanges[n][o][a];e.weightChanges[n][o][a]=e.values[i][o]*e.der[r][a]*e.learnRate+s,e.weights[n][o][a]+=e.weightChanges[n][o][a]}e.biases[n]=e.biases[n].map(function(n,e){return t.learnRate*t.der[r][e]+n})},e=this,i=0;i<this.weights.length;i++)n(i)},t.prototype.mse=function(){for(var t=0,n=0,e=0;e<this.derTotals.length;e++)t+=this.derTotals[e].reduce(function(t,e){return n++,t+Math.pow(e,2)},0);return t/n},t}();n.activationMethods={ReLU:function(t){return Math.max(t,0)},sigmoid:function(t){return 1/(1+Math.exp(-t))},tanh:function(t){var n=(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t));return n}},n.deriviteMethods={ReLU:function(t){var n=t<=0?0:1;return n},sigmoid:function(t){var e=n.activationMethods.sigmoid;return e(t)*(1-e(t))},tanh:function(t){return 1-Math.pow(n.activationMethods.tanh(t),2)}},n.costMethods={sqErr:function(t,n){return n-t},absErr:function(){}},t.Network=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function t(t,n,e){this.rawMax=1,this.R=t,this.gamma=n,this.goal=e,this.Q={};for(var i in t){this.Q[i]={};for(var r in t[i])this.Q[i][r]=0}this.gamma=n}return t.prototype.grow=function(t,n){for(var e=0;e<n.length;e++)this.R[t][n[e]]=null},t.prototype.explore=function(t){},t.prototype.transition=function(t,n){var e,i=!0;for(n in this.R[t])null===this.R[t][n]&&(e=n,i=!1);e=this.max(n),this.Q[t][n]=this.R[t][n]+this.gamma*this.Q[n][e]},t.prototype.max=function(t){var n=0,e=null;for(var i in this.Q[t])e?this.Q[t][i]===n&&Math.random()>.5?(n=this.Q[t][i],e=i):this.Q[t][i]>n&&(n=this.Q[t][i],e=i):(n=this.Q[t][i],e=i);return e},t.prototype.possible=function(t){var n=[];for(var e in this.R[t])this.R[t][e]>-1&&n.push(e);return n[Math.floor(Math.random()*n.length)]},t.prototype.episode=function(t){return this.transition(t,this.possible(t)),this.Q},t.prototype.normalize=function(){for(var t in this.Q)for(var n in this.Q[t])this.Q[n][t]>=this.rawMax&&(this.rawMax=this.Q[n][t]);for(var t in this.Q)for(var n in this.Q[t])this.Q[n][t]=Math.round(this.Q[n][t]/this.rawMax*100)},t}();t.QLearner=n}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){function n(n,e){var i=this,r=t.Utils.dataToMatrix(n,this.standardized),o=e.data,a=o.length,s=n.map(function(t){return t.mean}),h=n.map(function(t){return t.sd}),u=n.map(function(t){return[t.variance]});s.unshift(1),h.unshift(1),u.unshift([1]),this.standardized&&(o=t.Utils.standardized(e.data));var c=r,p=o.map(function(t){return[t]}),f=jStat.transpose(c),l=jStat.multiply(f,c),d=jStat.multiply(f,p),v=jStat.multiply(jStat.inv(l),d);this.betas=v.reduce(function(t,n){return t.concat(n)}),this.stErrCoeff=jStat.multiply(jStat.inv(l),u).reduce(function(t,n){return t.concat(n)}),this.tStats=this.stErrCoeff.map(function(t,n){return i.betas[n]/t}),this.pValues=this.tStats.map(function(t,n){return jStat.ttest(t,s[n],h[n],a)});var m=[];e.data.map(function(t,n){r[n].shift();var e=r[n];return m[n]=i.predict(e),t-m[n]});return this.betas}function e(t,n){}t.ols=n,t.pls=e}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){var n=function(t){function n(n,e,i,r,o){var a=t.call(this,n)||this;return a.states=e,a.transitions=a.checkTransitions(i),a.conditions=r,a.data=o,a}return __extends(n,t),n.prototype.update=function(t,e){for(var i in t.states){var r=t.states[i];this.states[r](t,e);for(var o=0;o<this.transitions.length;o++)for(var a=0;a<this.transitions[o].from.length;a++){var s=this.transitions[o].from[a];if(s===r){var h=this.conditions[this.transitions[o].name],u=void 0;u="function"==typeof h.value?h.value():h.value;var c=h.check(t[h.key],u);c===n.SUCCESS&&(t.states[i]=this.transitions[o].to,t[i]=t.states[i])}}}},n.prototype.checkTransitions=function(t){for(var n=0;n<t.length;n++)"string"==typeof t[n].from&&(t[n].from=[t[n].from]);return t},n}(t.QComponent);t.StateMachine=n}(QEpiKit||(QEpiKit={}));var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),QEpiKit;!function(t){function n(t,n,e,i){var r=1/(n+Math.exp(-i*(t-e)));return r}function e(t,n,e,i){var r=1/Math.log(t/(1-t));return r}function i(t,n,e,i){var r=n*t+e;return r}function r(t,n,e,i){var r=1-Math.pow(t,i)/Math.pow(1,i);return r}var o=function(t){function n(n,e,i){var r=t.call(this,n)||this;return r.options=e,r.results=[],r.data=i,r}return __extends(n,t),n.prototype.update=function(t,n){for(var e,i,r=[],o=0,a=0;a<this.options.length;a++){r[a]=0;for(var s=0;s<this.options[a].considerations.length;s++){var h=this.options[a].considerations[s],u=h.x(t,this.options[a].params);
r[a]+=h.f(u,h.m,h.b,h.k)}e=r[a]/this.options[a].considerations.length,this.results.push({point:t.id,opt:this.options[a].name,result:e}),e>o&&(t.top={name:this.options[a].name,util:e},i=a,o=e)}this.options[i].action(n,t)},n}(t.QComponent);t.USys=o,t.logistic=n,t.logit=e,t.linear=i,t.exponential=r}(QEpiKit||(QEpiKit={}));var QEpiKit;!function(t){var n=function(){function n(){}return n.createCSVURI=function(t){var n,e,i="data:text/csv;charset=utf-8,",r=[];return t.forEach(function(t){n=t.join(","),r.push(n)}),i+=r.join("\n"),e=encodeURI(i)},n.arrayFromRange=function(t,n,e){for(var i=[],r=t;r<n;)i.push(r),r+=e;return i},n.shuffle=function(t,n){for(var e,i,r=t.length;0!==r;)i=Math.floor(n()*r),r-=1,e=t[r],t[r]=t[i],t[i]=e;return t},n.generateUUID=function(){for(var t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=new Array(36),i=0,r=0;r<36;r++)8==r||13==r||18==r||23==r?e[r]="-":14==r?e[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),t=15&i,i>>=4,e[r]=n[19==r?3&t|8:t]);return e.join("")},n.always=function(t){return t===n.SUCCESS?n.SUCCESS:n.FAILED},n.eventually=function(t){return t===n.SUCCESS?n.SUCCESS:n.RUNNING},n.equalTo=function(t,e){return t===e?n.SUCCESS:n.FAILED},n.not=function(t){var e;return t===n.SUCCESS?e=n.FAILED:t===n.FAILED&&(e=n.SUCCESS),e},n.notEqualTo=function(t,e){return t!==e?n.SUCCESS:n.FAILED},n.gt=function(t,e){return t>e?n.SUCCESS:n.FAILED},n.gtEq=function(t,e){return t>=e?n.SUCCESS:n.FAILED},n.lt=function(t,e){return t<e?n.SUCCESS:n.FAILED},n.ltEq=function(t,e){return t<=e?n.SUCCESS:n.FAILED},n.hasProp=function(t,e){return t=t||!1,t===e?n.SUCCESS:n.FAILED},n.inRange=function(t,e){return e>=t[0]&&e<=t[1]?n.SUCCESS:n.FAILED},n.notInRange=function(t,e){return e>=t[0]&&e<=t[1]?n.FAILED:n.SUCCESS},n.getMatcherString=function(n){var e=null;switch(n){case t.Utils.equalTo:e="equal to";break;case t.Utils.notEqualTo:e="not equal to";break;case t.Utils.gt:e="greater than";break;case t.Utils.gtEq:e="greater than or equal to";break;case t.Utils.lt:e="less than";break;case t.Utils.ltEq:e="less than or equal to";break;case t.Utils.hasProp:e="has the property";break;default:try{e="not a defined matcher"}catch(t){console.log(t)}}return e},n.setMin=function(t,n){for(var e in t)"undefined"!=typeof n&&n.indexOf(e)!==-1?t[e].current=t[e].value-t[e].error:"undefined"==typeof n&&(t[e].current=t[e].value-t[e].error)},n.setMax=function(t,n){for(var e in t)"undefined"!=typeof n&&n.indexOf(e)!==-1?t[e].current=t[e].value+t[e].error:"undefined"==typeof n&&(t[e].current=t[e].value+t[e].error)},n.setStandard=function(t,n){for(var e in t)"undefined"!=typeof n&&n.indexOf(e)!==-1?t[e].current=t[e].value:"undefined"==typeof n&&(t[e].current=t[e].value)},n.dataToMatrix=function(t,e){void 0===e&&(e=!1);for(var i=[],r=0;r<t.length;r++){var o=t[r];e&&(o=n.standardized(o)),o.forEach(function(t,n){"undefined"==typeof i[n]?i[n]=[1,t]:i[n].push(t)})}return i},n.standardized=function(t){var n=jStat.stdev(t),e=jStat.mean(t),i=t.map(function(t){return(t-e)/n});return i},n.normalize=function(t,n,e){var i=t-n;return i/(e-n)},n.invNorm=function(t,n,e){return t*e-t*n+n},n.randRange=function(t,n){return(n-t)*Math.random()+t},n.prototype.getRange=function(t,n){for(var e={min:1e15,max:-1e15},i=0;i<t.length;i++)e.min>t[i][n]&&(e.min=t[i][n]),e.max<t[i][n]&&(e.max=t[i][n]);return e},n}();n.SUCCESS=1,n.FAILED=2,n.RUNNING=3,t.Utils=n;var e=function(){function t(){}return t.gt=function(t,n){return t>n},t.ge=function(t,n){return t>=n},t.lt=function(t,n){return t<n},t.le=function(t,n){return t<=n},t}();t.Match=e}(QEpiKit||(QEpiKit={}));