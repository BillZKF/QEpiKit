<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>QEpiKit Basics Page</title>
  <link href="style.css" rel="stylesheet"></link>
  <script src="../bower_components/d3/d3.min.js"></script>
</head>

<body>
  <div>
    <h1>Introduction</h1>
    <div>
      Models have a number of roles in epidemiology. They are used to forecast or predict future outcomes based on available data, they are used for projecting and comparing outcomes for a variety of scenarios, and they can be used to enhance understanding
      of causal relationships through evaluation of counterfactuals. In the next two sections, I'll provide brief introductions to two of the main types of models used in epidemiology with example code from this library. My views are neither authorataive
    </div>
    <h1>Compartment Models</h1>
    <div>
      Many introductions to epidemiological modeling start with a simple model with three compartments: Succeptible, Infectious, and Removed. Each compartment is assigned a starting population. Using ordinary differential equations (ODE), some portion of the
      Succeptible population flows into the Infectious compartment, while some portion of the Infectious population flows into the Removed compartment. The parameters determining the size of portion transitioning to the next compartment in these "SIR"
      examples are usually provided as 'beta' for the transmission rate (Succeptible to Infectious) and 'gamma' for the recovery rate (Infectious to Removed). I'm going to use 'transmission parameter' and 'recovery parameter' here. Below are two visualizations
      of this simple "SIR" model.
    </div>
    <button onclick="sir=true">Run Model</button>
    <div id="sir-diagrams"></div>
    <div>
      The javascript code below shows how this example was created. The CompartmentModel class uses Heun's method (2nd order) differential equation solver. In the future, I'd like to implement an adaptive-step <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta%E2%80%93Fehlberg_method">Runge–Kutta–Fehlberg</a>      method.
    </div>
    <div>
      Contemporary compartment models are more sophisticated. They add additional compartments (like an exposed-latent period) relevant to the disease's pathology, population vital dynamics (births and deaths), environmental factors like weather / temperature,
      and frequently include spatial "patches" and modeling of travel patterns between patches.
      <ul>
        Examples:
        <li><a href="http://www.gleamviz.org/challenges/">GLEAMviz</a></li>
        <li><a href="https://www.eclipse.org/stem/">IBM STEM</a></li>
      </ul>
    </div>
    <div>Below I've included a more complex compartment model and code, demonstrating how some of these concepts can be implemented using this library.
    </div>
    <button onclick="seir=true">Run Model</button>
    <div id="seirs-diagrams"></div>
    <h1>Agent Based Models</h1>
    <div>Agent based models take a completely different approach. Instead of using a total population figure and moving a portion of that population between compartments, an agent is typically used to represent an individual within the population and is assigned
      a set of relevant and representative properties (like age, gender, body-mass, etc.). A set of agents, their behaviors and interactions is then modeled over a time period. Agent based models also frequently include models of the environment, and
      social contact patterns.
    </div>

    <h2>Agent "Microdata"</h2>
    <div>
      <p>One of the first challenges I ran into when trying out agent based modeling is the need for realistic "microdata", data representing individual agents. Without access to detailed patient records, it can be tough to find a dataset that represents the population
      you're trying to model. Several larger projects, including <a href="https://www.rti.org/pubs/mr-0010-0905-wheaton.pdf">MIDAS (Wheaton, et al., 2009 )</a>, have combined a variety of population and individual level sources and methods to generate
      agent microdata.</p>
      <p>In this library each agent is represented a <a href="http://www.json.org/">JSON</a> object, within an array. Below I outline a method for using the Census Bureau's RESTful APIs, and the chance.js library to generate population data for a census
      tract. This method can be expanded to generate zip code or county level data as well.</p>
    </div>

    <h2>Environment</h2>
    <div>
      The environment could mean a few different things in the context of agent based modeling.
    </div>
    <div>
      In this library the environment contains resources, which can be described as sets of finite resources, a schedule, which is keeps time for the model, and an event queue which dispatches certain events at or during certain time intervals.
    </div>
    <h2>Social Contact Patterns</h2>
    <div>
      The interactions between agents is important to most models. One of the most common ways to model social contacts, is to create a matrix with all of the possible contacts 1 to 1 and assign each a contact frequency.
    </div>
    <h2>Rules!</h2>
    <div>
      Within the model, agents (and the environment) usually behave according to some set of rules. Sometimes these rules are simple conditional / flow control statements, sometimes they are implemented using their own syntax, or they fit within a larger framework or
      system with it's own set of rules. Unfortunately, how rules for agents are implemented seems to be less standardized or at least less reported in the literature than would be useful.</div>
    <div>For this library I wanted the rules to be explicit (all in one place), language standards compliant, and shareable between models, and easily implemented in other languages.
    </div>
    <h3>Hybrid Automata</h3>
    <div>One way to model agents and their behavior is to treat the agent as a <a href="http://www.ecse.rpi.edu/~agung/course/vanderschaft.pdf">hybrid dynamic system (hds)</a>. This is a type of system with continuous and discrete variables and time dynamics.
      In practice it means using differential equations (for describing the behavior of continous state variables over time) and comparison operators (=, >=, !=) at continuous value thresholds. I'll introduce the concept of hds and hybrid automata with
      a canonical example of an air conditioner:</div>
    <div>
      This basic air conditioner:
      <ol>
        <li>Can be ON or OFF. These discrete states are elements of the AC's
          <strong>set of modes</strong> = [ON, OFF].</li>
        <li>Checks the environment's temperature "x", which is a continuous variable and is part of this system's continous state space or
          <strong>flow set</strong> = {x : [0:100]}.
          <li>When it is OFF, the temperature goes up (towards 85), and when it's ON the air conditioner blasts 65 degree air. When represented as a set of differential equations (or vector fields), this is called the
            <strong>flow map</strong> ={x: {ON:65 - x, OFF:85 - x}}.</li>
          <li>Knows when to switch modes based of the current temperature. This is called the
            <strong>jump set</strong> = {ON:{x >= 74}, OFF:{x
            <=71}}. </li>
              <li>Should know whether anything special happens to "x" when we go from ON to OFF or OFF to ON. In this example, it doesn't so the
                <strong>jump map</strong> is just = {ON=>OFF(x):x, OFF=>ON(x):x}.</li>
              <li>We also want to be explicit that the air conditioner can go from ON to OFF and OFF to ON. These are called
                <strong>edges</strong> = [[ON,OFF], [OFF,ON]]</li>
      </ol>
      <div id="ac-diagram"></div>
    </div>
    <div>
      Based on this very simple example, it may be hard to see exactly how these concepts are applied to epidemiological modeling. Let's consider a simplified infectious disease model spreading through (doesn't have to, but should be) an English boardings school
      with 25 students:
      <ol>
        <li>We'll say that the modes = [SUCCEPTIBLE, INFECTIOUS, LATENT]</li>
        <li>The flow set will contain the person's pathogen shedding rate = [1 : 10], immune response = [1:100] and pathogen load = [1 :1000]</li>
        <li>The flow map is more involved this time.
          <pre>embed gist
          </pre>
        </li>
        <li>
          The jump set will include = { INFECTIOUS:{agent.load >= 100}, LATENT:{agent.load
          <=50} } </li>
            <li>
              The jump map will not be anything but identity as above.
            </li>
            <li>
              The edges include = [[SUCCEPTIBLE, INFECTIOUS][INFECTIOUS,LATENT]]
            </li>
      </ol>
    </div>
    <div id="ha-contact-graph"></div>
    <div id="ha-contact-diagram"></div>
    <div>
      Here, in addition to a contact frequency, each agent sheds the pathogen at a rate proportional to their total pathogen load. As the pathogen load increases, an immuneResponse is engaged, removing a portion of that load each step.
    </div>
    <h2>Sources</h2>
    <iframe width="840" height="360" frameborder="0" scrolling="no" src="https://onedrive.live.com/embed?cid=2D54C2F48C7536A5&resid=2D54C2F48C7536A5%2138618&authkey=AKuWQfeI3XA_8F8&em=2&wdHideGridlines=True&wdHideHeaders=True&wdDownloadButton=True"></iframe>
    <script src="../dist/compartment.js"></script>
    <script src="../dist/ha.js"></script>
    <script src="../dist/contactPatch.js"></script>
    <script src="../dist/utils.js"></script>
    <script src="qepikit-renderer.js"></script>
    <script src="ha-examples.js"></script>
    <script src="ha-id-example.js"></script>
    <script src="cm-examples.js"></script>

  </div>
</body>
