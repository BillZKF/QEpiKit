<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>QKit</title>
    <link rel="stylesheet" href="app.css" type="text/css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="app.js"></script>
    <script src="epi.js"></script>
    <script src="sir.js"></script>
</head>
<body>
    <h1>Quantative Toolkit in Typescript</h1>

    <div id="content">

        <div id="results">
            Time : <div id="time"></div>
            Suceptible : <div id="succeptible"></div>
            Infectious : <div id="infectious"></div>
            Removed : <div id="removed"></div>
            BRN : <div id="BRN"></div>
            <p id="graph"></p>
        </div>
        <script>
            var t = 0;
            var measles = new QKit.SIR(
                { succeptible: 1000, infectious: 10, removed: 0 },
                { transmissionRate: 3.7247 , recoveryRate: 0.142 }
                );

            var svg = d3.select("p").append("svg").attr("height", 360).attr("width", 640).append("g");
           
            var x = d3.scale.linear()
                .domain([0, 3])
                .range([0, 640])

            var y = d3.scale.linear()
                .domain([measles.totalPop, 0])
                .range([0, 360])

            var xAxis = d3.svg.axis()
								.scale(x)
								.orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left");

            var infect = svg.append("circle")
                    .attr("cx", 0)
                    .attr("cy", 0)
                    .attr('r', 7)
					.style({
					    'opacity': 1,
					    'stroke': '#fa0',
					    'fill': '#fcf',
					    'stroke-width': 1
					});

            var succept = svg.append("circle")
                    .attr("cx", 0)
                    .attr("cy", 0)
                    .attr('r', 7)
					.style({
					    'opacity': 1,
					    'stroke': '#0af',
					    'fill': '#cfc',
					    'stroke-width': 1
					});

            var main = function () {
                measles.update();
                document.getElementById("time").innerHTML = measles.step * t;
                document.getElementById("succeptible").innerHTML = Math.round(measles.succeptible);
                document.getElementById("infectious").innerHTML = Math.round(measles.infectious);
                document.getElementById("removed").innerHTML = Math.round(measles.removed);
                document.getElementById("BRN").innerHTML = Math.round(measles.basicReproductionNumber);
                //svg.selectAll("*").remove();

                svg.append("g")
			    .attr("class", "axis")
			    .attr("transform", "translate(0,300)")
			    .call(xAxis);

                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(60,0)")
                    .call(yAxis);

                
                infect.attr("cx",  x(measles.step * t)).attr("cy", y(measles.infectious));
                succept.attr('transform', 'translate(' + x(measles.step * t) + ',' + y(measles.succeptible) + ')');
                t++;
                
                requestAnimationFrame(main);
                
            }
            main();
            
        </script>
    </div>
</body>
</html>
