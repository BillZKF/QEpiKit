<html>

<head>
  <script src="../bower_components/pixi/bin/pixi.min.js"></script>
  <script src="../qepikit.min.js"></script>
</head>

<body>
  <h1>GLRender Examples</h2>
    <script>
      (function(Q) {
        Q.GLRenderer = {
          ScatterXY: function(xyData, options) {
            // create an new instance of a pixi stage
            var domain = [],
              pixMargins = [],
              pXmargin, pYmargin;
            this.xyData = xyData;
            this.stage = new PIXI.Container();
            this.renderer = PIXI.autoDetectRenderer(options.width, options.height, {
              backgroundColor: options.bgColor
            });
            this.scales = [options.extents.x, options.extents.y];

            domain = [];
            domain[0] = Math.abs(this.scales[0].min - this.scales[0].max);
            domain[1] = Math.abs(this.scales[1].min - this.scales[1].max);

            pixMargins = [];
            pixMargins[0] = options.marginsX || this.renderer.width * 0.05;
            pixMargins[1] = options.marginsY || this.renderer.height * 0.05;
            range = {
              x: {},
              y: {}
            };
            range.x.min = 0 + pixMargins[0];
            range.x.max = this.renderer.width - pixMargins[0];
            range.y.max = 0 + pixMargins[1];
            range.y.min = this.renderer.height - pixMargins[1];

            pW = Math.abs(range.x.min - range.x.max);
            pH = Math.abs(range.y.min - range.y.max)

            var xLabel = new PIXI.Text('X Axis');
            var yLabel = new PIXI.Text('Y Axis');
            xLabel.x = range.x.min;
            xLabel.y = range.y.min;

            yLabel.x = range.x.min - 30;
            yLabel.y = range.y.min;
            yLabel.rotation = -90 * (Math.PI / 180);
            this.stage.addChild(xLabel);
            this.stage.addChild(yLabel);
            this.container = document.body.appendChild(this.renderer.view);
            this.axes = Q.GLRenderer.XYAxes();
            scatterPlot = new PIXI.Graphics();
            this.xyData.map(function(point) {
              var scaled = {
                x: 0,
                y: 0
              };
              scaled.x = point.x * (pW / domain[0]) + pixMargins[0];
              scaled.y = range.y.min - (point.y * (pH / domain[1]));
              scatterPlot.beginFill(0x4488ff, 0.7).drawCircle(scaled.x, scaled.y, 2);
            })
            this.scatterPlot = scatterPlot;
            this.stage.addChild(scatterPlot);
            this.renderer.render(this.stage);
            return this;
          }
        }
        return Q;
      })(QEpiKit || {});


      var w = 960;
      var h = 540;
      var data = []
      var xMin = 1e6;
      var yMin = 1e6;
      var xMax = -1000;
      var yMax = -1000;
      for (var i = 0; i < 40000; i++) {
        data.push({
          x: Math.random() * w,
          y: Math.random() * h * 3
        });

        if (data[i].x > xMax) {
          xMax = data[i].x;
        }
        if (data[i].x < xMin) {
          xMin = data[i].x;
        }
        if (data[i].y > yMax) {
          yMax = data[i].y;
        }

        if (data[i].y < yMin) {
          yMin = data[i].y;
        }
      }

      var options = {
        bgColor: 0xffffff,
        width: w,
        height: h,
        extents: {
          x: {
            min: xMin,
            max: xMax
          },
          y: {
            min: yMin,
            max: yMax
          }
        }
      };
      var P = QEpiKit.GLRenderer.ScatterXY(data, options);
      target = 3.5;
      sFactor = 0.0001;
      animate = function() {
        requestAnimationFrame(animate);
        if(target == 3.5){
          sFactor += 0.00001
          if( P.stage.scale.x > target){
            target = 0.5;
          }
        } else if ( target == 0.5){
          sFactor -= 0.00001;
          if(P.stage.scale.x < target){
            target = 3.5;
            sFactor = 0.00001;
          }
        }
        P.stage.scale.x = P.stage.scale.x + sFactor;
        P.stage.scale.y = P.stage.scale.y + sFactor;
        // render the container
        P.renderer.render(P.stage);
      }

      animate();
    </script>
</body>

</html>
